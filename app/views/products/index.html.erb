<div class="container my-5">
  <div class="<%= current_user.приёмщик? && 'product-index' %> card shadow">
    <% if current_user.приёмщик? %>
    <div class="card-header text-center">
      <h3><%= params[:end_product] ? 'Оформить продажу'.upcase : 'ПРИЕМ МАКУЛАТУРУ:' %></h3>
    </div>
      <div style='display: flex; flex-direction:column; align-items:center; justify-content:center;'>
        <% @products.where(weight: 0).each do |product| %>
          <%= link_to new_expenditure_path(product_id: product.id, expenditure_type: Expenditure.expenditure_types.keys.first ) do %>
            <div class='shadow' style='width: 520px; text-align:center; margin: 10px; height: 90px; background-color:<%= handle_product_bg_color(product.id) %>;  display: flex; justify-content: center; align-items: center;'>
              <h2 style='color: black'><%= product.name %></h2>
            </div>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="card-title font-weight-bold"><%= params[:end_product] ? 'Товары'.upcase : 'СЫРЬЯ' %></h3>
      </div>
      <div class="card-body">
        <% if @products.any? -%>
          <table class="table table-bordered table-striped table-hover">
            <thead>
              <tr>
                <th>Название</th>
                <th>остаток</th>
                <th>общая сумма</th>
                <th>средняя</th>
                <th>Действия</th>
              </tr>
            </thead>
            <tbody>
              <% @products.each do |product| -%>
                <tr>
                  <td style='font-size:large; font-weight: bold; background-color: <%= handle_product_bg_color(product.id) %>'><%= product.name %></td>
                  <td><%= product.amount_left %></td>
                  <td><%= num_to_usd((product.product_prices.average(:price) || 0) * product.amount_left) %></td>
                  <td><%= num_to_usd(product.product_prices.average(:price)) %></td>
                  <td>
                    <%= clink_to 'посмотреть детально', product_expenditure_expenditures_path(q: {product_id_eq: product.id}), 'fa-eye' %>
                    <%= clink_to 'редактировать', edit_product_path(product), 'fa-edit' %>
                  </td>
                  <td>
                    <% if params[:end_product] %>
                      <%= clink_to 'Оформить продажу', define_outcomer_incomes_path, 'fa-truck-ramp-box' %>
                    <% else %>
                      <%= clink_to 'Добить приход товара', new_expenditure_path(product_id: product.id, expenditure_type: Expenditure.expenditure_types.keys.first ), 'fa-truck-ramp-box' %>
                    <% end %>
                  </td>
                  <% if product.weight == 1 %>
                    <td>
                      <%= clink_to 'Добить возврат', new_refund_path, 'fa-right-left' %>
                    </td>
                  <% end %>
                </tr>
              <% end -%>
            </tbody>
          </table>
        <% else -%>
          <p class="text-center">Товаров нет.</p>
        <% end -%>
      </div>
    <% end %>
  </div>
</div>
